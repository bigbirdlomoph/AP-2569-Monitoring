<div id="summary-page" class="page-section d-none fade-in">
    
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h3 class="fw-bold text-dark mb-0"><i class="fas fa-chart-pie me-2 text-secondary"></i>รายงานสรุปผลการเบิกจ่าย (Executive Summary)</h3>
            <small class="text-muted">ข้อมูลภาพรวมการบริหารงบประมาณ ประจำปี 2569</small>
        </div>
        <button class="btn btn-outline-secondary shadow-sm" onclick="window.print()">
            <i class="fas fa-print me-1"></i> พิมพ์รายงาน
        </button>
    </div>

    <div class="card border-0 shadow-sm mb-4">
        <div class="card-body bg-light rounded-3 py-3">
          <div class="row g-2 align-items-end">
            <div class="col-md-3">
                <label class="form-label fw-bold small text-muted">ปีงบประมาณ</label>
                <select class="form-select bg-white" disabled>
                    <option selected>2569</option>
                </select>
            </div>
            <div class="col-md-3">
                <label class="form-label fw-bold small text-muted">เลือกไตรมาส</label>
                <select class="form-select" id="sumQuarter" onchange="loadSummary()">
                    <option value="">-- ทั้งปีงบประมาณ --</option>
                    <option value="Q1">ไตรมาส 1 (ต.ค.-ธ.ค.)</option>
                    <option value="Q2">ไตรมาส 2 (ม.ค.-มี.ค.)</option>
                    <option value="Q3">ไตรมาส 3 (เม.ย.-มิ.ย.)</option>
                    <option value="Q4">ไตรมาส 4 (ก.ค.-ก.ย.)</option>
                </select>
            </div>
            <div class="col-md-3">
                <label class="form-label fw-bold small text-muted">เลือกเดือน</label>
                <select class="form-select" id="sumMonth" onchange="loadSummary()">
                    <option value="">-- ทุกเดือน --</option>
                    <option value="0">ตุลาคม</option><option value="1">พฤศจิกายน</option><option value="2">ธันวาคม</option>
                    <option value="3">มกราคม</option><option value="4">กุมภาพันธ์</option><option value="5">มีนาคม</option>
                    <option value="6">เมษายน</option><option value="7">พฤษภาคม</option><option value="8">มิถุนายน</option>
                    <option value="9">กรกฎาคม</option><option value="10">สิงหาคม</option><option value="11">กันยายน</option>
                </select>
            </div>
            <div class="col-md-3">
                <button class="btn btn-primary w-100 shadow-sm" onclick="loadSummary()">
                    <i class="fas fa-sync-alt me-2"></i>อัปเดตข้อมูล
                </button>
            </div>
          </div>
        </div>
    </div>

    <div class="row g-3 mb-4">
        <div class="col-md-6 col-xl-3">
            <div class="card-metric h-100 shadow-sm text-white" style="background-color: #0d6efd; border-radius: 15px;">
                <div class="card-label" style="font-size: 0.9rem; opacity: 0.9;">งบประมาณรวม</div>
                <div class="card-value fw-bold" id="s-total-alloc"><i class="fas fa-spinner fa-spin small"></i></div>
                <i class="fas fa-coins card-icon opacity-25"></i>
            </div>
        </div>

        <div class="col-md-6 col-xl-3">
            <div class="card-metric h-100 shadow-sm text-white" style="background-color: #fd7e14; border-radius: 15px;">
                <div class="card-label" style="font-size: 0.9rem; opacity: 0.9;">เบิกจ่ายรวม</div>
                <div class="card-value fw-bold" id="s-total-spent"><i class="fas fa-spinner fa-spin small"></i></div>
                <i class="fas fa-hand-holding-usd card-icon opacity-25"></i>
            </div>
        </div>

        <div class="col-md-6 col-xl-3">
            <div class="card-metric h-100 shadow-sm bg-white border border-2 border-primary" style="border-radius: 15px;">
                <div class="card-label text-primary fw-bold" style="font-size: 0.9rem;">ร้อยละการเบิกจ่าย</div>
                <div class="card-value text-primary fw-bold" id="s-total-pct">0.00%</div>
                <i class="fas fa-percent card-icon text-primary opacity-25"></i>
            </div>
        </div>

        <div class="col-md-6 col-xl-3">
            <div class="card-metric h-100 shadow-sm text-white" style="background-color: #0dcaf0; border-radius: 15px;">
                <div class="card-label" style="font-size: 0.9rem; opacity: 0.9;">คงเหลือสุทธิ</div>
                <div class="card-value fw-bold" id="s-total-bal"><i class="fas fa-spinner fa-spin small"></i></div>
                <i class="fas fa-wallet card-icon opacity-25"></i>
            </div>
        </div>
    </div>

    <div class="row g-4 mb-5">
        <div class="col-lg-5">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-header bg-white fw-bold border-bottom py-3">
                    <i class="fas fa-chart-pie me-2 text-primary"></i>สัดส่วนงบประมาณ (จำแนกตามแหล่งเงิน)
                </div>
                <div class="card-body">
                    <div style="height: 300px; position: relative;">
                        <canvas id="chartSource"></canvas>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-lg-7">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-header bg-white fw-bold border-bottom py-3">
                    <i class="fas fa-chart-bar me-2 text-success"></i>5 อันดับกลุ่มงานที่ได้รับจัดสรรสูงสุด
                </div>
                <div class="card-body">
                    <div style="height: 300px; position: relative;">
                        <canvas id="chartTopDept"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="card border-0 shadow-sm mb-4">
        <div class="card-header bg-primary text-white fw-bold py-3">
            <i class="fas fa-list me-2"></i>1. สรุปรายละเอียดจำแนกตามแหล่งเงิน (Budget Source)
        </div>
        <div class="card-body p-0">
            <div class="table-responsive">
                <table class="table table-hover align-middle mb-0">
                    <thead class="bg-light">
                        <tr>
                            <th class="ps-4" style="width: 30%;">แหล่งเงิน</th>
                            <th class="text-center" style="width: 10%;">โครงการ</th>
                            <th class="text-end" style="width: 15%;">งบจัดสรร</th>
                            <th class="text-end" style="width: 15%;">เบิกจ่าย</th>
                            <th class="text-center" style="width: 10%;">ร้อยละ</th>
                            <th class="text-end pe-4" style="width: 20%;">คงเหลือ</th>
                        </tr>
                    </thead>
                    <tbody id="tableSourceBody">
                        <tr><td colspan="6" class="text-center py-4 text-muted">กรุณากดปุ่มอัปเดตข้อมูล...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <div class="card border-0 shadow-sm mb-5">
        <div class="card-header bg-success text-white p-0">
            <div class="d-flex align-items-center flex-wrap">
                <div class="fw-bold px-3 py-3 flex-grow-1">
                    <i class="fas fa-building me-2"></i>2. สรุปผลงานจำแนกตามกลุ่มงาน
                </div>
                
                <ul class="nav nav-tabs nav-fill card-header-tabs ms-auto me-0 border-bottom-0" role="tablist" style="min-width: 400px;">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active fw-bold" id="tab-btn-all" data-bs-toggle="tab" data-bs-target="#tab-all" type="button">
                            <i class="fas fa-layer-group me-1"></i> ทั้งหมด
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link text-white opacity-75" id="tab-btn-moph" data-bs-toggle="tab" data-bs-target="#tab-moph" type="button" style="border:none;">
                            <i class="fas fa-university me-1"></i> งบ สป.สธ.
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link text-white opacity-75" id="tab-btn-non" data-bs-toggle="tab" data-bs-target="#tab-non" type="button" style="border:none;">
                            <i class="fas fa-wallet me-1"></i> เงินนอก สป.
                        </button>
                    </li>
                </ul>
            </div>
        </div>
        
        <div class="card-body p-0">
            <div class="tab-content">
                
                <div class="tab-pane fade show active" id="tab-all" role="tabpanel">
                    <div class="table-responsive">
                        <table class="table table-hover align-middle mb-0">
                            <thead class="bg-light">
                                <tr>
                                    <th class="ps-4" style="width: 25%;">กลุ่มงาน (ภาพรวม)</th>
                                    <th class="text-center" style="width: 10%;">โครงการ</th>
                                    <th class="text-end" style="width: 15%;">จัดสรร</th>
                                    <th class="text-end" style="width: 15%;">เบิกจ่าย</th>
                                    <th style="width: 20%;" class="text-center">ความก้าวหน้า</th>
                                    <th class="text-end pe-4" style="width: 15%;">คงเหลือ</th>
                                </tr>
                            </thead>
                            <tbody id="tableDeptAllBody">
                                <tr><td colspan="6" class="text-center py-4 text-muted">กำลังโหลดข้อมูล...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <div class="tab-pane fade" id="tab-moph" role="tabpanel">
                    <div class="table-responsive">
                        <table class="table table-hover align-middle mb-0">
                            <thead class="bg-light">
                                <tr>
                                    <th class="ps-4" style="width: 25%;">กลุ่มงาน (เฉพาะ สป.สธ.)</th>
                                    <th class="text-center" style="width: 10%;">โครงการ</th>
                                    <th class="text-end" style="width: 15%;">จัดสรร</th>
                                    <th class="text-end" style="width: 15%;">เบิกจ่าย</th>
                                    <th style="width: 20%;" class="text-center">ความก้าวหน้า</th>
                                    <th class="text-end pe-4" style="width: 15%;">คงเหลือ</th>
                                </tr>
                            </thead>
                            <tbody id="tableDeptMophBody">
                                <tr><td colspan="6" class="text-center py-4 text-muted">กำลังโหลดข้อมูล...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <div class="tab-pane fade" id="tab-non" role="tabpanel">
                    <div class="table-responsive">
                        <table class="table table-hover align-middle mb-0">
                            <thead class="bg-light">
                                <tr>
                                    <th class="ps-4" style="width: 25%;">กลุ่มงาน (เฉพาะ เงินนอก)</th>
                                    <th class="text-center" style="width: 10%;">โครงการ</th>
                                    <th class="text-end" style="width: 15%;">จัดสรร</th>
                                    <th class="text-end" style="width: 15%;">เบิกจ่าย</th>
                                    <th style="width: 20%;" class="text-center">ความก้าวหน้า</th>
                                    <th class="text-end pe-4" style="width: 15%;">คงเหลือ</th>
                                </tr>
                            </thead>
                            <tbody id="tableDeptNonBody">
                                <tr><td colspan="6" class="text-center py-4 text-muted">กำลังโหลดข้อมูล...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <style>
        /* Active Tab Style */
        .nav-tabs .nav-link.active {
            color: #198754 !important;
            background-color: #fff;
            font-weight: bold;
            border-top: 3px solid #157347; /* Top green line hint */
            border-bottom: none;
        }
        /* Inactive Tabs */
        .nav-tabs .nav-link {
            color: rgba(255,255,255,0.85);
            font-weight: 500;
        }
        .nav-tabs .nav-link:hover {
            color: #fff;
            background-color: rgba(255,255,255,0.1);
            border-color: transparent;
        }
        /* [เพิ่มใหม่] แก้ไข Modal ให้ลอยเหนือ Navbar และดันลงมาต่ำหน่อย */
        .modal {
            z-index: 1060 !important; /* ค่าปกติ Navbar คือ 1030, ต้องมากกว่า */
        }
        .modal-backdrop {
            z-index: 1055 !important;
        }
        .modal-dialog {
            margin-top: 80px; /* ดันลงมาไม่ให้ชนขอบบน */
        }
    </style>

  <div class="modal fade" id="deptDrillDownModal" tabindex="-1">
        <div class="modal-dialog modal-xl modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header bg-success text-white">
                    <h5 class="modal-title fw-bold">
                        <i class="fas fa-search-plus me-2"></i>รายละเอียด: <span id="ddTitle">...</span>
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body bg-light">
                    
                    <div class="row g-2 mb-3">
                        <div class="col-md-4"><div class="card bg-white border-0 shadow-sm p-3 text-center h-100"><small class="text-muted fw-bold">งบจัดสรรรวม</small><div class="h4 text-success mb-0 fw-bold" id="ddAlloc">...</div></div></div>
                        <div class="col-md-4"><div class="card bg-white border-0 shadow-sm p-3 text-center h-100"><small class="text-muted fw-bold">เบิกจ่ายรวม</small><div class="h4 text-danger mb-0 fw-bold" id="ddSpent">...</div></div></div>
                        <div class="col-md-4"><div class="card bg-white border-0 shadow-sm p-3 text-center h-100"><small class="text-muted fw-bold">ความก้าวหน้าภาพรวม</small><div class="h4 text-primary mb-0 fw-bold" id="ddProgress">...</div></div></div>
                    </div>

                    <div class="card border-0 shadow-sm">
                        <div class="card-header bg-white p-0">
                            <ul class="nav nav-tabs nav-fill card-header-tabs m-0" role="tablist">
                                <li class="nav-item"><button class="nav-link active fw-bold py-3 text-success" data-bs-toggle="tab" data-bs-target="#tab-dd-all" type="button">ทั้งหมด</button></li>
                                <li class="nav-item"><button class="nav-link fw-bold py-3 text-secondary" data-bs-toggle="tab" data-bs-target="#tab-dd-moph" type="button">งบ สป.สธ.</button></li>
                                <li class="nav-item"><button class="nav-link fw-bold py-3 text-secondary" data-bs-toggle="tab" data-bs-target="#tab-dd-non" type="button">เงินนอก สป.</button></li>
                            </ul>
                        </div>
                        
                        <div class="card-body p-0">
                            <div class="tab-content">
                                <div class="tab-pane fade show active" id="tab-dd-all">
                                    <div class="table-responsive">
                                        <table class="table table-striped table-hover align-middle mb-0 small">
                                            <thead class="table-light sticky-top"><tr><th class="ps-3" style="width: 40%">ชื่อโครงการ/กิจกรรม</th><th class="text-end" style="width: 15%">งบจัดสรร</th><th class="text-end" style="width: 15%">เบิกจ่าย</th><th class="text-center" style="width: 15%">สถานะ</th><th class="text-end pe-3" style="width: 15%">คงเหลือ</th></tr></thead>
                                            <tbody id="ddTableBodyAll"></tbody>
                                        </table>
                                    </div>
                                </div>
                                <div class="tab-pane fade" id="tab-dd-moph">
                                    <div class="table-responsive">
                                        <table class="table table-striped table-hover align-middle mb-0 small">
                                            <thead class="table-light sticky-top"><tr><th class="ps-3" style="width: 40%">ชื่อโครงการ (สป.สธ.)</th><th class="text-end" style="width: 15%">งบจัดสรร</th><th class="text-end" style="width: 15%">เบิกจ่าย</th><th class="text-center" style="width: 15%">สถานะ</th><th class="text-end pe-3" style="width: 15%">คงเหลือ</th></tr></thead>
                                            <tbody id="ddTableBodyMoph"></tbody>
                                        </table>
                                    </div>
                                </div>
                                <div class="tab-pane fade" id="tab-dd-non">
                                    <div class="table-responsive">
                                        <table class="table table-striped table-hover align-middle mb-0 small">
                                            <thead class="table-light sticky-top"><tr><th class="ps-3" style="width: 40%">ชื่อโครงการ (เงินนอก)</th><th class="text-end" style="width: 15%">งบจัดสรร</th><th class="text-end" style="width: 15%">เบิกจ่าย</th><th class="text-center" style="width: 15%">สถานะ</th><th class="text-end pe-3" style="width: 15%">คงเหลือ</th></tr></thead>
                                            <tbody id="ddTableBodyNon"></tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
                <div class="modal-footer py-1">
                    <button type="button" class="btn btn-secondary btn-sm" data-bs-dismiss="modal">ปิดหน้าต่าง</button>
                </div>
            </div>
        </div>
    </div>


</div>
